<!-- Demand Tab -->
<div class="tab-pane fade" id="demand" role="tabpanel">
    <div class="row">
        <div class="col-md-6">
            <!-- Demand Table -->
            <div class="data-table-container">
                <div class="card-header">
                    <h5 class="card-title mb-0">
                        <i class="bx bx-table me-2"></i>
                        Tabla de Demanda Diaria
                    </h5>
                </div>
                <div class="card-body">
                    <div class="table-responsive" style="max-height: 400px;">
                        <table class="table table-striped" id="demandTable">
                            <thead>
                                <tr>
                                    <th>Día</th>
                                    <th>Fecha</th>
                                    <th>Demanda (L)</th>
                                    <th>Desviación (%)</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for simulate in results %}
                                <tr>
                                    <td>{{ forloop.counter }}</td>
                                    <td>{{ simulate.date|date:"d/m/Y" }}</td>
                                    <td class="fw-bold">{{ simulate.demand_mean|floatformat:"2" }}</td>
                                    <td>
                                        <span class="badge bg-info">
                                            {{ simulate.demand_std_deviation|floatformat:"2" }}%
                                        </span>
                                    </td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                </div>
                <div class="pagination-controls">
                    <button type="button" class="btn btn-sm btn-outline-primary btn-pagination" id="prevTablePage">
                        <i class="bx bx-chevron-left me-1"></i>Anterior
                    </button>
                    <span class="flex-grow-1 text-center small text-muted" id="tablePageInfo">
                        Página 1
                    </span>
                    <button type="button" class="btn btn-sm btn-outline-primary btn-pagination" id="nextTablePage">
                        Siguiente<i class="bx bx-chevron-right ms-1"></i>
                    </button>
                </div>
            </div>
        </div>
        <div class="col-md-6">
            <div class="chart-container">
                <h6 class="mb-3">
                    <i class="bx bx-line-chart-down me-2"></i>
                    Análisis de Demanda con Tendencias
                </h6>
                {% if image_data_simulation %}
                <img src="data:image/png;base64,{{ image_data_simulation }}" 
                        class="chart-image" 
                        alt="Análisis de demanda"
                        loading="lazy">
                {% endif %}
            </div>
        </div>
        {% if comparison_chart %}
        <div class="col-12 mb-4">
            <div class="chart-container">
                <h6 class="mb-3">
                    <i class="bx bx-git-compare me-2"></i>
                    Comparación: Demanda Histórica vs Simulada
                </h6>
                <div class="chart-controls">
                    <div class="chart-control-btn" onclick="downloadChart('{{ comparison_chart }}', 'comparacion-demanda.png')" title="Descargar">
                        <i class="bx bx-download"></i>
                    </div>
                    <div class="chart-control-btn" onclick="openFullscreen('{{ comparison_chart }}', 'Comparación de Demanda')" title="Pantalla completa">
                        <i class="bx bx-fullscreen"></i>
                    </div>
                </div>
                <img src="data:image/png;base64,{{ comparison_chart }}" 
                    class="chart-image" 
                    alt="Comparación de Demanda Histórica vs Simulada"
                    loading="lazy">
            </div>
        </div>
        {% endif %}
        <!-- Three-Line Validation Chart Section -->
        {% if has_three_line_chart %}
        <div class="row mb-4">
            <div class="col-12">
                <div class="card shadow-sm">
                    <div class="card-header bg-success text-white">
                        <h4 class="mb-0">
                            <i class="fas fa-check-circle"></i> Validación del Modelo: Comparación de Tres Líneas
                        </h4>
                    </div>
                    <div class="card-body">
                        <div class="row">
                            <div class="col-lg-9">
                                {% if three_line_validation_chart %}
                                    <img src="data:image/png;base64,{{ three_line_validation_chart }}" 
                                        class="img-fluid rounded shadow" 
                                        alt="Gráfico de Validación de Tres Líneas">
                                {% endif %}
                            </div>
                            <div class="col-lg-3">
                                <div class="validation-metrics">
                                    <h5>Métricas de Validación</h5>
                                    
                                    {% if three_line_validation_metrics.historical_vs_simulated %}
                                    <div class="metric-card mb-3 p-3 bg-light rounded">
                                        <h6 class="text-muted">Histórico vs Simulado</h6>
                                        <p class="mb-1">RMSE: <strong>{{ three_line_validation_metrics.historical_vs_simulated.rmse|floatformat:2 }}</strong></p>
                                    </div>
                                    {% endif %}
                                    
                                    {% if three_line_validation_metrics.simulated_vs_projected %}
                                    <div class="metric-card mb-3 p-3 bg-light rounded">
                                        <h6 class="text-muted">Simulado vs Proyectado</h6>
                                        <p class="mb-1">MAPE: <strong>{{ three_line_validation_metrics.simulated_vs_projected.mape }}%</strong></p>
                                        <p class="mb-0">Alineación: <strong>{{ three_line_validation_metrics.simulated_vs_projected.alignment }}</strong></p>
                                    </div>
                                    {% endif %}
                                    
                                    {% if three_line_validation_metrics.overall_validation %}
                                    <div class="metric-card p-3 bg-primary text-white rounded">
                                        <h6>Validación General</h6>
                                        <h3 class="mb-1">{{ three_line_validation_metrics.overall_validation.score|floatformat:1 }}%</h3>
                                        <p class="mb-0">{{ three_line_validation_metrics.overall_validation.status }}</p>
                                    </div>
                                    {% endif %}
                                </div>
                            </div>
                        </div>
                        
                        <div class="mt-3 p-3 bg-light rounded">
                            <h6>Interpretación del Gráfico:</h6>
                            <ul class="mb-0">
                                <li><span style="color: blue; font-weight: bold;">Línea Azul</span>: Demanda Real Histórica</li>
                                <li><span style="color: red; font-weight: bold;">Línea Roja</span>: Demanda Proyectada (tendencia futura)</li>
                                <li><span style="color: green; font-weight: bold;">Línea Verde (punteada)</span>: Demanda Simulada (validación del modelo)</li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        {% endif %}
    </div>
</div>